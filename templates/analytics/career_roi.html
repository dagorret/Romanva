{% extends 'base.html' %}

{% block title %}ROI Educativo por Carrera - Romanova{% endblock %}

{% block content %}
<div class="container">
    <h2>üìä ROI Educativo por Carrera</h2>
    <p class="subtitle">An√°lisis Costo-Beneficio Educativo: Inversi√≥n vs Retorno por Carrera</p>

    <!-- Resumen Ejecutivo Global -->
    <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 30px;">
        <h3 style="margin-top: 0; color: white;">üí∞ Indicadores Globales de Inversi√≥n</h3>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
            <div style="text-align: center;">
                <div style="font-size: 16px; opacity: 0.9; margin-bottom: 5px;">Inversi√≥n Total</div>
                <div style="font-size: 32px; font-weight: bold;">${{ total_investment|floatformat:0 }}</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 16px; opacity: 0.9; margin-bottom: 5px;">Beneficio Estimado</div>
                <div style="font-size: 32px; font-weight: bold;">${{ total_benefit|floatformat:0 }}</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 16px; opacity: 0.9; margin-bottom: 5px;">ROI Global</div>
                <div style="font-size: 32px; font-weight: bold; {% if global_roi > 0 %}color: #10b981;{% else %}color: #ef4444;{% endif %}">
                    {{ global_roi }}%
                </div>
            </div>
        </div>
    </div>

    <!-- Mejor y Peor Carrera -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
        <!-- Mejor -->
        {% if best_career %}
        <div class="card" style="border: 3px solid #10b981;">
            <h3 style="color: #10b981;">üèÜ Carrera con Mejor ROI</h3>
            <div style="background: #ecfdf5; padding: 20px; border-radius: 10px;">
                <h4 style="margin: 0; font-size: 22px; color: #111827;">{{ best_career.career }}</h4>
                <div style="margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <div style="font-size: 13px; color: #6b7280;">ROI</div>
                        <div style="font-size: 24px; font-weight: bold; color: #10b981;">{{ best_career.roi }}%</div>
                    </div>
                    <div>
                        <div style="font-size: 13px; color: #6b7280;">Retenci√≥n</div>
                        <div style="font-size: 24px; font-weight: bold; color: #7c3aed;">{{ best_career.retention_rate }}%</div>
                    </div>
                    <div>
                        <div style="font-size: 13px; color: #6b7280;">Estudiantes</div>
                        <div style="font-size: 18px; font-weight: bold; color: #111827;">{{ best_career.total_students }}</div>
                    </div>
                    <div>
                        <div style="font-size: 13px; color: #6b7280;">Eficiencia</div>
                        <div style="font-size: 18px; font-weight: bold; color: #111827;">{{ best_career.efficiency }}</div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Peor -->
        {% if worst_career %}
        <div class="card" style="border: 3px solid #ef4444;">
            <h3 style="color: #ef4444;">‚ö†Ô∏è Carrera con Menor ROI</h3>
            <div style="background: #fef2f2; padding: 20px; border-radius: 10px;">
                <h4 style="margin: 0; font-size: 22px; color: #111827;">{{ worst_career.career }}</h4>
                <div style="margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <div style="font-size: 13px; color: #6b7280;">ROI</div>
                        <div style="font-size: 24px; font-weight: bold; color: #ef4444;">{{ worst_career.roi }}%</div>
                    </div>
                    <div>
                        <div style="font-size: 13px; color: #6b7280;">Retenci√≥n</div>
                        <div style="font-size: 24px; font-weight: bold; color: #7c3aed;">{{ worst_career.retention_rate }}%</div>
                    </div>
                    <div>
                        <div style="font-size: 13px; color: #6b7280;">Estudiantes</div>
                        <div style="font-size: 18px; font-weight: bold; color: #111827;">{{ worst_career.total_students }}</div>
                    </div>
                    <div>
                        <div style="font-size: 13px; color: #6b7280;">Eficiencia</div>
                        <div style="font-size: 18px; font-weight: bold; color: #111827;">{{ worst_career.efficiency }}</div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Tabla Completa de Carreras -->
    {% if careers %}
    <div class="card">
        <h3>üìà An√°lisis Completo por Carrera</h3>
        <p style="color: #6b7280; margin-bottom: 20px;">
            Costo estimado por curso: <strong>$5,000 USD</strong> (ajusta seg√∫n tu instituci√≥n)
        </p>

        <table>
            <thead>
                <tr>
                    <th>Carrera</th>
                    <th>Cursos</th>
                    <th>Estudiantes</th>
                    <th>Activos</th>
                    <th>Retenci√≥n (%)</th>
                    <th>Accesos Prom.</th>
                    <th>Costo Total</th>
                    <th>Beneficio Est.</th>
                    <th>ROI (%)</th>
                    <th>Rating</th>
                </tr>
            </thead>
            <tbody>
                {% for career in careers %}
                <tr>
                    <td><strong>{{ career.career }}</strong></td>
                    <td>{{ career.courses_count }}</td>
                    <td>{{ career.total_students }}</td>
                    <td>{{ career.active_students }}</td>
                    <td>
                        <span style="font-weight: 600; color: {% if career.retention_rate > 70 %}#10b981{% elif career.retention_rate > 40 %}#f59e0b{% else %}#ef4444{% endif %}">
                            {{ career.retention_rate }}%
                        </span>
                    </td>
                    <td>{{ career.avg_accesses }}</td>
                    <td style="color: #6b7280;">${{ career.total_cost|floatformat:0 }}</td>
                    <td style="color: #10b981; font-weight: 600;">${{ career.estimated_benefit|floatformat:0 }}</td>
                    <td>
                        <strong style="font-size: 16px; color: {% if career.roi > 100 %}#10b981{% elif career.roi > 50 %}#f59e0b{% elif career.roi > 0 %}#fb923c{% else %}#ef4444{% endif %}">
                            {{ career.roi }}%
                        </strong>
                    </td>
                    <td>{{ career.roi_rating }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert">
        <p>No hay datos de carreras disponibles para an√°lisis de ROI.</p>
    </div>
    {% endif %}

    <!-- F√≥rmulas y Metodolog√≠a -->
    <div class="card" style="margin-top: 30px; background: #f9fafb;">
        <h3>üßÆ Metodolog√≠a de C√°lculo</h3>
        <div style="color: #374151; line-height: 1.8;">
            <p><strong>F√≥rmulas utilizadas:</strong></p>

            <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0; font-family: monospace; border-left: 4px solid #7c3aed;">
                <strong>Costo Total:</strong> N√∫mero de Cursos √ó $5,000<br>
                <strong>Beneficio Estimado:</strong> Estudiantes √ó Accesos Promedio √ó (Retenci√≥n/100) √ó 100<br>
                <strong>ROI:</strong> ((Beneficio - Costo) / Costo) √ó 100<br>
                <strong>Eficiencia:</strong> Alta si Retenci√≥n > 70% y Accesos > 10
            </div>

            <p><strong>Interpretaci√≥n del ROI:</strong></p>
            <ul style="margin-left: 20px;">
                <li><strong>ROI > 100%:</strong> üü¢ Excelente - La carrera genera m√°s del doble del valor invertido</li>
                <li><strong>ROI 50-100%:</strong> üü° Bueno - Retorno positivo pero con margen de mejora</li>
                <li><strong>ROI 0-50%:</strong> üü† Regular - Apenas cubre costos, requiere optimizaci√≥n</li>
                <li><strong>ROI < 0%:</strong> üî¥ Deficitario - Genera menos valor del que cuesta, revisar urgente</li>
            </ul>
        </div>
    </div>

    <!-- Recomendaciones Estrat√©gicas -->
    <div class="card" style="margin-top: 30px; background: #fef3c7;">
        <h3 style="color: #78350f;">üí° Recomendaciones Estrat√©gicas</h3>
        <div style="color: #78350f; line-height: 1.8;">
            <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #10b981;">
                <strong>Para Carreras de Alto ROI (>100%):</strong>
                <ul style="margin-top: 10px;">
                    <li>Aumentar capacidad de inscripci√≥n si hay demanda</li>
                    <li>Documentar y replicar mejores pr√°cticas en otras carreras</li>
                    <li>Usar como casos de √©xito en marketing institucional</li>
                    <li>Mantener calidad docente y recursos asignados</li>
                </ul>
            </div>

            <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ef4444;">
                <strong>Para Carreras de Bajo ROI (<50%):</strong>
                <ul style="margin-top: 10px;">
                    <li>Revisar estructura curricular: ¬ødemasiados cursos con poco valor?</li>
                    <li>Analizar calidad docente y satisfacci√≥n estudiantil</li>
                    <li>Considerar fusionar cursos similares para reducir costos</li>
                    <li>Implementar programas de retenci√≥n urgentes</li>
                    <li>Evaluar viabilidad a largo plazo de la carrera</li>
                </ul>
            </div>

            <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #7c3aed;">
                <strong>Acciones Generales:</strong>
                <ul style="margin-top: 10px;">
                    <li>Revisar el costo estimado por curso ($5,000) y ajustarlo a la realidad institucional</li>
                    <li>Monitorear tendencias trimestrales: ¬ømejora o empeora el ROI?</li>
                    <li>Correlacionar con empleabilidad post-graduaci√≥n</li>
                    <li>Presentar a junta directiva: decisiones de inversi√≥n basadas en datos</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Nota Importante -->
    <div class="card" style="margin-top: 30px; background: #dbeafe; border-left: 4px solid #3b82f6;">
        <p style="color: #1e40af; margin: 0; line-height: 1.6;">
            <strong>‚ö†Ô∏è Nota Importante:</strong> Este an√°lisis es una <strong>aproximaci√≥n cuantitativa</strong> basada en engagement y retenci√≥n.
            El ROI educativo real incluye factores cualitativos dif√≠ciles de medir: calidad de aprendizaje, empleabilidad,
            impacto social, reputaci√≥n institucional, etc. Use estos datos como <strong>uno de varios inputs</strong> para decisiones estrat√©gicas.
        </p>
    </div>

    <div style="margin-top: 30px;">
        <a href="{% url 'analytics_menu' %}" class="button">‚Üê Volver al men√∫ de estad√≠sticas</a>
    </div>
</div>
{% endblock %}
