{% extends 'base.html' %}

{% block title %}SegmentaciÃ³n Inteligente - Romanova{% endblock %}

{% block content %}
<div class="container">
    <h2>ğŸ“ SegmentaciÃ³n Inteligente de Estudiantes</h2>
    <p class="subtitle">K-Means avanzado con {{ features_analyzed }} caracterÃ­sticas: perfiles detallados de comportamiento</p>

    <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 30px;">
        <h3 style="margin-top: 0; color: white;">ğŸ“Š Resumen de SegmentaciÃ³n</h3>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
            <div style="text-align: center;">
                <div style="font-size: 36px; font-weight: bold;">{{ total_students }}</div>
                <div style="font-size: 14px; opacity: 0.9;">Estudiantes Analizados</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 36px; font-weight: bold;">{{ clusters|length }}</div>
                <div style="font-size: 14px; opacity: 0.9;">Segmentos Identificados</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 36px; font-weight: bold;">{{ features_analyzed }}</div>
                <div style="font-size: 14px; opacity: 0.9;">Variables Analizadas</div>
            </div>
        </div>
    </div>

    {% if clusters %}
    {% for cluster in clusters %}
    <div class="card" style="margin-bottom: 20px; border-left: 4px solid {% if cluster.profile == 'ğŸŒŸ SÃºper Activos' %}#10b981{% elif cluster.profile == 'ğŸ“š Comprometidos' %}#3b82f6{% elif cluster.profile == 'âš ï¸ En Riesgo' %}#f59e0b{% else %}#ef4444{% endif %};">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
            <div>
                <h3 style="margin: 0;">{{ cluster.profile }}</h3>
                <p style="margin: 5px 0 0 0; color: #6b7280;">{{ cluster.size }} estudiantes ({{ cluster.size|floatformat:0 }})</p>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 48px;">
                    {% if cluster.profile == 'ğŸŒŸ SÃºper Activos' %}ğŸŒŸ
                    {% elif cluster.profile == 'ğŸ“š Comprometidos' %}ğŸ“š
                    {% elif cluster.profile == 'âš ï¸ En Riesgo' %}âš ï¸
                    {% else %}ğŸ’¤{% endif %}
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; padding: 15px; background: #f9fafb; border-radius: 8px;">
            <div>
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Accesos (30 dÃ­as)</div>
                <div style="font-size: 20px; font-weight: bold; color: #111827;">{{ cluster.avg_accesses_30 }}</div>
            </div>
            <div>
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Consistencia</div>
                <div style="font-size: 20px; font-weight: bold; color: #111827;">{{ cluster.avg_consistency }}</div>
            </div>
            <div>
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Cursos Diversos</div>
                <div style="font-size: 20px; font-weight: bold; color: #111827;">{{ cluster.avg_unique_courses }}</div>
            </div>
        </div>

        <details>
            <summary style="cursor: pointer; padding: 10px; background: #f3f4f6; border-radius: 6px; font-weight: 600;">
                Ver primeros 10 estudiantes de este segmento
            </summary>
            <div style="margin-top: 15px;">
                <table style="font-size: 13px;">
                    <thead>
                        <tr>
                            <th>Estudiante</th>
                            <th>Accesos (30d)</th>
                            <th>Accesos (90d)</th>
                            <th>Cursos</th>
                            <th>Consistencia</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for member in cluster.members %}
                        <tr>
                            <td>{{ member.user.fullname }}</td>
                            <td>{{ member.accesses_30 }}</td>
                            <td>{{ member.accesses_90 }}</td>
                            <td>{{ member.courses_enrolled }}</td>
                            <td>{{ member.consistency }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </details>
    </div>
    {% endfor %}

    <div class="card" style="background: #fef3c7; margin-top: 30px;">
        <h3 style="color: #78350f;">ğŸ’¡ Acciones por Segmento</h3>
        <div style="color: #78350f; line-height: 1.8;">
            <p><strong>ğŸŒŸ SÃºper Activos:</strong></p>
            <ul>
                <li>Ofrecer contenido avanzado y desafÃ­os adicionales</li>
                <li>Considerarlos como mentores para otros estudiantes</li>
                <li>Invitarlos a programas de liderazgo o becas</li>
            </ul>

            <p><strong>ğŸ“š Comprometidos:</strong></p>
            <ul>
                <li>Mantener su motivaciÃ³n con reconocimientos</li>
                <li>Proveer recursos adicionales para mejorar</li>
                <li>Monitorear para evitar que caigan a riesgo</li>
            </ul>

            <p><strong>âš ï¸ En Riesgo:</strong></p>
            <ul>
                <li><strong>AcciÃ³n urgente:</strong> Contacto personalizado del tutor</li>
                <li>Identificar barreras especÃ­ficas (tiempo, dificultad, motivaciÃ³n)</li>
                <li>Ofrecer tutorÃ­as o recursos de apoyo</li>
            </ul>

            <p><strong>ğŸ’¤ Inactivos:</strong></p>
            <ul>
                <li><strong>Prioridad mÃ¡xima:</strong> IntervenciÃ³n inmediata</li>
                <li>Verificar si continÃºan inscritos o han abandonado silenciosamente</li>
                <li>Encuesta de satisfacciÃ³n para entender causas</li>
            </ul>
        </div>
    </div>
    {% else %}
    <div class="alert">
        <p>No hay suficientes estudiantes activos para realizar segmentaciÃ³n (mÃ­nimo 4 con historial).</p>
    </div>
    {% endif %}

    <div style="margin-top: 30px;">
        <a href="{% url 'analytics_menu' %}" class="button">â† Volver al menÃº de estadÃ­sticas</a>
    </div>
</div>
{% endblock %}
