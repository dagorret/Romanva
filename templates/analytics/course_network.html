{% extends 'base.html' %}

{% block title %}Red de Cursos Relacionados - Romanova{% endblock %}

{% block content %}
<div class="container">
    <h2>üîó Red de Cursos Relacionados (Course Network Analysis)</h2>
    <p class="subtitle">Qu√© cursos toman juntos los estudiantes - An√°lisis de co-ocurrencia</p>

    <!-- Resumen Ejecutivo -->
    <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; margin-bottom: 30px;">
        <h3 style="margin-top: 0; color: white;">üìä Estad√≠sticas de Red</h3>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
            <div style="text-align: center;">
                <div style="font-size: 36px; font-weight: bold;">{{ total_relationships }}</div>
                <div style="font-size: 14px; opacity: 0.9;">Relaciones Detectadas</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 36px; font-weight: bold;">{{ total_students_analyzed }}</div>
                <div style="font-size: 14px; opacity: 0.9;">Estudiantes Analizados</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 36px; font-weight: bold;">{{ hub_courses|length }}</div>
                <div style="font-size: 14px; opacity: 0.9;">Cursos "Hub"</div>
            </div>
        </div>
    </div>

    <!-- Cursos Hub (m√°s conectados) -->
    {% if hub_courses %}
    <div class="card" style="margin-bottom: 30px;">
        <h3>‚≠ê Cursos "Hub" - M√°s Relacionados con Otros</h3>
        <p style="color: #6b7280; margin-bottom: 20px;">
            Estos cursos se toman frecuentemente junto con otros. Son candidatos ideales para:
            <strong>prerrequisitos, cursos introductorios, o materias troncales</strong>
        </p>

        <table>
            <thead>
                <tr>
                    <th>Ranking</th>
                    <th>Curso</th>
                    <th>N√∫mero de Conexiones</th>
                    <th>Popularidad</th>
                </tr>
            </thead>
            <tbody>
                {% for hub in hub_courses %}
                <tr style="{% if forloop.counter0 < 3 %}background: #fef3c7;{% endif %}">
                    <td>
                        <strong style="{% if forloop.counter0 == 0 %}color: #fbbf24; font-size: 18px;{% elif forloop.counter0 == 1 %}color: #94a3b8; font-size: 16px;{% elif forloop.counter0 == 2 %}color: #cd7f32; font-size: 16px;{% endif %}">
                            #{{ forloop.counter }}
                        </strong>
                    </td>
                    <td><strong>{{ hub.course.fullname }}</strong></td>
                    <td>
                        <span style="font-size: 20px; font-weight: bold; color: #7c3aed;">{{ hub.connections }}</span>
                        <span style="color: #6b7280; font-size: 13px;"> conexiones</span>
                    </td>
                    <td>{{ hub.popularity }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- Relaciones entre Cursos -->
    {% if network_relationships %}
    <div class="card">
        <h3>üîó Top Relaciones entre Cursos</h3>
        <p style="color: #6b7280; margin-bottom: 20px;">
            Pares de cursos frecuentemente tomados juntos. M√≠nimo 3 estudiantes en com√∫n.
        </p>

        <table>
            <thead>
                <tr>
                    <th>Curso 1</th>
                    <th>‚ÜîÔ∏è</th>
                    <th>Curso 2</th>
                    <th>Estudiantes en Com√∫n</th>
                    <th>Fuerza (%)</th>
                    <th>Relaci√≥n</th>
                </tr>
            </thead>
            <tbody>
                {% for rel in network_relationships %}
                <tr>
                    <td>{{ rel.course1.shortname }}</td>
                    <td style="text-align: center; font-size: 20px;">
                        {% if rel.relationship == 'Fuerte' %}
                            üî¥
                        {% elif rel.relationship == 'Media' %}
                            üü°
                        {% else %}
                            üîµ
                        {% endif %}
                    </td>
                    <td>{{ rel.course2.shortname }}</td>
                    <td>
                        <strong style="font-size: 16px;">{{ rel.students_in_common }}</strong> estudiantes
                    </td>
                    <td>
                        <span style="font-weight: 600; color: {% if rel.strength > 50 %}#dc3545{% elif rel.strength > 25 %}#ffc107{% else %}#0d6efd{% endif %}">
                            {{ rel.strength }}%
                        </span>
                    </td>
                    <td>
                        <span style="padding: 4px 12px; border-radius: 12px; font-size: 13px; font-weight: 600;
                            {% if rel.relationship == 'Fuerte' %}background: #fee; color: #dc3545;{% elif rel.relationship == 'Media' %}background: #fef3c7; color: #d97706;{% else %}background: #dbeafe; color: #1e40af;{% endif %}">
                            {{ rel.relationship }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert">
        <p>No se encontraron suficientes relaciones entre cursos (m√≠nimo 3 estudiantes en com√∫n).</p>
    </div>
    {% endif %}

    <!-- Interpretaci√≥n y Uso -->
    <div class="card" style="margin-top: 30px; background: #f0f9ff;">
        <h3 style="color: #0369a1;">üí° ¬øC√≥mo Interpretar y Usar esta Red?</h3>
        <div style="color: #075985; line-height: 1.8;">
            <p><strong>Fuerza de Relaci√≥n:</strong> Se calcula como (Estudiantes en Com√∫n / Max Inscriptos en Cualquiera de los 2) √ó 100</p>

            <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #0ea5e9;">
                <strong>üéØ Aplicaciones Estrat√©gicas:</strong>
                <ul style="margin-top: 10px;">
                    <li><strong>Dise√±o Curricular:</strong> Cursos fuertemente relacionados podr√≠an beneficiarse de coordinaci√≥n docente</li>
                    <li><strong>Recomendaciones Personalizadas:</strong> Sugerir a estudiantes de Curso A que tomen Curso B</li>
                    <li><strong>Detecci√≥n de Patrones:</strong> Si dos cursos "deber√≠an" estar relacionados pero no lo est√°n, investigar por qu√©</li>
                    <li><strong>Optimizaci√≥n de Horarios:</strong> Evitar que cursos relacionados tengan horarios incompatibles</li>
                    <li><strong>Identificar Cuellos de Botella:</strong> Cursos hub con baja capacidad pueden bloquear progreso de muchos estudiantes</li>
                </ul>
            </div>

            <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #7c3aed;">
                <strong>üìö Ejemplos de Uso:</strong>
                <ul style="margin-top: 10px;">
                    <li><strong>Caso 1:</strong> Si "C√°lculo I" y "F√≠sica I" tienen 80% de fuerza ‚Üí Coordinar contenidos y fechas de ex√°menes</li>
                    <li><strong>Caso 2:</strong> Si un curso hub tiene pocas conexiones inesperadamente ‚Üí Revisar prerrequisitos o marketing</li>
                    <li><strong>Caso 3:</strong> Crear "paquetes de cursos" basados en relaciones fuertes para facilitar inscripci√≥n</li>
                </ul>
            </div>

            <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #f59e0b;">
                <strong>‚ö†Ô∏è Nota Metodol√≥gica:</strong>
                <p style="margin-top: 10px;">
                    Este an√°lisis se basa en co-ocurrencia actual de estudiantes. Para an√°lisis m√°s profundo,
                    considere tambi√©n: secuencia temporal (qu√© toman primero), tasas de aprobaci√≥n conjuntas,
                    y feedback cualitativo de estudiantes.
                </p>
            </div>
        </div>
    </div>

    <div style="margin-top: 30px;">
        <a href="{% url 'analytics_menu' %}" class="button">‚Üê Volver al men√∫ de estad√≠sticas</a>
    </div>
</div>
{% endblock %}
