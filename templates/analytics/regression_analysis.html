{% extends 'base.html' %}

{% block title %}Regresi√≥n y Predicci√≥n - Romanova Platform{% endblock %}

{% block content %}
<div class="container">
    <h2>üìâ An√°lisis de Regresi√≥n y Predicci√≥n de Tendencias</h2>
    <p class="subtitle">An√°lisis de {{ days_analyzed }} d√≠as con predicci√≥n de {{ weeks_predicted }} semanas futuras</p>

    {% if predictions %}
        {% for pred in predictions %}
        <div class="card" style="margin-bottom: 30px;">
            <h3>{{ pred.course.shortname }} - {{ pred.course.fullname }}</h3>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <h4>M√©tricas de Regresi√≥n</h4>
                    <p><strong>Pendiente:</strong> {{ pred.slope }}</p>
                    <p><strong>R¬≤ (ajuste):</strong> {{ pred.r_squared }}</p>
                    <p><strong>Tendencia:</strong>
                        <span style="color: {% if pred.trend == 'Creciente' %}green{% elif pred.trend == 'Decreciente' %}red{% else %}orange{% endif %};">
                            {{ pred.trend }}
                        </span>
                    </p>
                </div>
                <div>
                    <h4>Promedios</h4>
                    <p><strong>Promedio actual:</strong> {{ pred.avg_current }} accesos/semana</p>
                    <p><strong>Promedio predicho:</strong> {{ pred.avg_predicted }} accesos/semana</p>
                    <p><strong>Cambio estimado:</strong>
                        {% if pred.avg_predicted > pred.avg_current %}
                            +{{ pred.avg_predicted|floatformat:2|add:pred.avg_current|floatformat:2 }}%
                        {% else %}
                            {{ pred.avg_predicted|floatformat:2|add:pred.avg_current|floatformat:2 }}%
                        {% endif %}
                    </p>
                </div>
            </div>

            <h4>Datos Semanales Actuales</h4>
            <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                {% for value in pred.weekly_data %}
                <div style="background: #4CAF50; height: {{ value|add:10 }}px; width: 20px; display: inline-block;" title="Semana {{ forloop.counter }}: {{ value }} accesos"></div>
                {% endfor %}
            </div>

            <h4>Predicci√≥n Pr√≥ximas Semanas</h4>
            <div style="display: flex; gap: 5px;">
                {% for value in pred.future_predictions %}
                <div style="background: #2196F3; height: {{ value|add:10 }}px; width: 20px; display: inline-block;" title="Semana +{{ forloop.counter }}: {{ value }} accesos"></div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="alert">
            <p>No hay suficientes datos para realizar predicciones.</p>
        </div>
    {% endif %}

    <div style="margin-top: 30px;">
        <a href="{% url 'analytics_menu' %}" class="button">‚Üê Volver al men√∫ de estad√≠sticas</a>
    </div>
</div>
{% endblock %}
